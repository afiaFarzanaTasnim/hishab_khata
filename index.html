<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>হিসাব-খাতা</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="app.js"></script>
</head>

<body>
  <div id="app" class="app">
    <!-- Auth Modal -->
    <div id="authModal" class="auth-overlay show">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <div class="auth-logo">
              <img src="assets/logo.png" alt="Logo" class="logo-icon">
              <h1>হিসাব-খাতা</h1>
            </div>
          </div>

          <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signup" data-i18n="signup">Sign Up</button>
            <button class="auth-tab" data-tab="login" data-i18n="login">Log In</button>
          </div>

          <div id="signupPane" class="auth-pane">
            <div class="form-group">
              <label data-i18n="business_name_label">Business name</label>
              <div class="input-icon">
                <i class="fas fa-briefcase"></i>
                <input id="signupBizName" placeholder="Acme Mart" />
              </div>
            </div>
            <div class="form-group">
              <label data-i18n="owner_email_label">Owner email</label>
              <div class="input-icon">
                <i class="fas fa-envelope"></i>
                <input id="signupEmail" type="email" placeholder="owner@shop.com" />
              </div>
            </div>
            <div class="form-group">
              <label data-i18n="owner_password_label">Password</label>
              <div class="input-icon">
                <i class="fas fa-lock"></i>
                <input id="signupPass" type="password" placeholder="••••••••" />
              </div>
            </div>
            <div class="checkbox-group">
              <input id="tosAgree" type="checkbox" />
              <label for="tosAgree" data-i18n="tos_text">Any profit or loss won't be our liability.</label>
            </div>
            <button id="signupBtn" class="btn-primary" data-i18n="create_business">Create business</button>
          </div>

          <div id="loginPane" class="auth-pane hidden">
            <div class="form-group">
              <label data-i18n="owner_email_label">Owner email</label>
              <div class="input-icon">
                <i class="fas fa-envelope"></i>
                <input id="loginEmail" type="email" placeholder="owner@shop.com" />
              </div>
            </div>
            <div class="form-group">
              <label data-i18n="owner_password_label">Password</label>
              <div class="input-icon">
                <i class="fas fa-lock"></i>
                <input id="loginPass" type="password" placeholder="••••••••" />
              </div>
            </div>
            <button id="loginBtn" class="btn-primary" data-i18n="login">Log In</button>
          </div>

          <div class="auth-divider">
            <span data-i18n="or">or</span>
          </div>

          <div class="lang-selector">
            <i class="fas fa-globe"></i>
            <select id="languageSelect">
              <option value="en">English</option>
              <option value="bn">বাংলা</option>
            </select>
          </div>

          <div id="onboardingStep" class="onboarding hidden">
            <h3 data-i18n="onboarding_title">Tell us about your business</h3>
            <div class="form-group">
              <label data-i18n="category_label">Business category</label>
              <input id="bizCategory" list="categorySuggestions" placeholder="Grocery, Pharmacy, Electronics..." />
              <datalist id="categorySuggestions"></datalist>
            </div>

            <div class="progress-flags">
              <div class="flag-item">
                <i class="fas fa-globe"></i>
                <span data-i18n="flag_language">Language</span>
                <i id="flagLang" class="fas fa-times flag-status"></i>
              </div>
              <div class="flag-item">
                <i class="fas fa-tag"></i>
                <span data-i18n="flag_category">Category</span>
                <i id="flagCategory" class="fas fa-times flag-status"></i>
              </div>
              <div class="flag-item">
                <i class="fas fa-check-circle"></i>
                <span data-i18n="flag_terms">Terms accepted</span>
                <i id="flagTos" class="fas fa-times flag-status"></i>
              </div>
            </div>

            <div class="csv-importer">
              <p data-i18n="importer_prompt">Do you have previous inventory data?</p>
              <input id="csvFile" type="file" accept=".csv" class="hidden" />
              <label for="csvFile" class="btn-secondary">
                <i class="fas fa-upload"></i>
                <span data-i18n="choose_file">Choose CSV File</span>
              </label>
              <button id="importCsvBtn" class="btn-secondary" data-i18n="import_csv">Import CSV</button>
              <button id="skipImportBtn" class="btn-ghost" data-i18n="skip">Skip</button>
              <p class="hint" data-i18n="csv_hint">Expected columns: name, sku, stock, buy_price, sell_price,
                low_stock(optional)</p>
              <pre id="csvPreview" class="preview hidden"></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main App Shell -->
    <aside class="sidebar">
      <div class="brand">
        <img src="assets/logo.png" alt="Logo" class="logo-icon">
        <div>
          <div class="bizname" id="sidebarBizName">হিসাব-খাতা</div>
          <small id="roleLabel">Admin</small>
        </div>
      </div>

      <nav>
        <button data-route="dashboard" class="nav-btn active">
          <i class="fas fa-chart-line"></i>
          <span data-i18n="dashboard">Dashboard</span>
        </button>
        <button data-route="inventory" class="nav-btn">
          <i class="fas fa-boxes"></i>
          <span data-i18n="inventory">Inventory</span>
        </button>
        <button data-route="billing" class="nav-btn">
          <i class="fas fa-file-invoice-dollar"></i>
          <span data-i18n="billing">Billing</span>
        </button>
        <button data-route="ads" class="nav-btn">
          <i class="fas fa-bullhorn"></i>
          <span data-i18n="advertising">Advertising</span>
        </button>
        <button data-route="recommend" class="nav-btn">
          <i class="fas fa-lightbulb"></i>
          <span data-i18n="recommendations">Recommendations</span>
        </button>
        <button data-route="employees" class="nav-btn">
          <i class="fas fa-users"></i>
          <span data-i18n="employees">Employees</span>
        </button>
        <button data-route="settings" class="nav-btn">
          <i class="fas fa-cog"></i>
          <span data-i18n="settings">Settings</span>
        </button>
        <button id="logoutBtn" class="btn-danger btn-small">
          <i class="fas fa-sign-out-alt"></i>
          <span data-i18n="logout">Log Out</span>
        </button>

      </nav>

      <div class="sidebar-footer">
        <button id="exportBtn" class="btn-ghost btn-small">
          <i class="fas fa-download"></i>
          <span data-i18n="export_data">Export Data</span>
        </button>
        <button id="importBtn" class="btn-ghost btn-small">
          <i class="fas fa-upload"></i>
          <span data-i18n="import_data">Import Data</span>
        </button>
        <input id="importJson" type="file" accept="application/json" class="hidden" />
        <div class="theme-toggle">
          <label class="switch">
            <input type="checkbox" id="themeSwitch" />
            <span class="slider"></span>
          </label>
          <span class="switch-label" data-i18n="dark_mode">Dark mode</span>
        </div>
      </div>
    </aside>

    <main class="main">
      <!-- DASHBOARD -->
      <section id="page-dashboard" class="page show">
        <div class="page-header">
          <h2 data-i18n="dashboard">Dashboard</h2>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon revenue">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
              <h3 data-i18n="total_revenue">Total revenue (last 30d)</h3>
              <div class="stat-value" id="totalRevenue">৳0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon forecast">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
              <h3 data-i18n="last7_forecast">Forecast next 7 days</h3>
              <div class="stat-value" id="forecast7">৳0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon inventory">
              <i class="fas fa-warehouse"></i>
            </div>
            <div class="stat-content">
              <h3 data-i18n="total_inventory_value">Inventory value</h3>
              <div class="stat-value" id="inventoryValue">৳0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon warning">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
              <h3 data-i18n="low_stock_count">Low-stock items</h3>
              <div class="stat-value" id="lowStockCount">0</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 data-i18n="sales_trend">Sales trend</h3>
            <select id="dashRange" class="select-compact">
              <option value="7">7d</option>
              <option value="30" selected>30d</option>
              <option value="90">90d</option>
            </select>
          </div>
          <canvas id="salesChart" height="120"></canvas>
        </div>

        <div class="card">
          <h3 data-i18n="quick_recommendations">Quick recommendations</h3>
          <ul id="quickRecs" class="recs-list"></ul>
        </div>
      </section>

      <!-- INVENTORY -->
      <section id="page-inventory" class="page">
        <div class="page-header">
          <h2 data-i18n="inventory">Inventory</h2>
          <div class="header-actions">
            <button id="addProductBtn" class="btn-primary">
              <i class="fas fa-plus"></i>
              <span data-i18n="add_product">Add product</span>
            </button>
            <button id="restockViewBtn" class="btn-secondary">
              <i class="fas fa-filter"></i>
              <span data-i18n="restock_only">Restock-only view</span>
            </button>
          </div>
        </div>

        <div class="card">
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input id="invSearch" placeholder="Search products..." data-i18n-placeholder="search_products" />
          </div>
          <div class="table-responsive">
            <div id="inventoryTable"></div>
          </div>
        </div>
      </section>

      <!-- BILLING -->
      <section id="page-billing" class="page">
        <div class="page-header">
          <h2 data-i18n="billing">Billing</h2>
        </div>

        <div class="billing-grid">
          <div class="card">
            <h3 data-i18n="invoice_builder">Invoice builder</h3>
            <div class="search-bar">
              <i class="fas fa-search"></i>
              <input id="billSearch" placeholder="Search item..." data-i18n-placeholder="search_item" />
            </div>
            <div class="form-group">
              <label>Customer name</label>
              <input id="billCustomer" placeholder="Customer name" />
            </div>
            <div id="billResults" class="items-list"></div>
            <div class="divider"></div>
            <div id="billCart" class="cart-items"></div>
            <div class="cart-footer">
              <button id="clearCartBtn" class="btn-ghost" data-i18n="clear">Clear</button>
              <div class="cart-total">
                <span data-i18n="total">Total</span>: <strong id="billTotal">৳0</strong>
                <button id="checkoutBtn" class="btn-primary">
                  <i class="fas fa-check"></i>
                  <span data-i18n="checkout">Checkout</span>
                </button>
              </div>
            </div>
          </div>

          <div class="card">
            <h3 data-i18n="invoice_template">Invoice template</h3>
            <div class="form-grid">
              <input id="tplName" placeholder="Store name" />
              <input id="tplAddr" placeholder="Address" />
              <input id="tplPhone" placeholder="Phone" />
              <input id="tplTax" placeholder="Tax %" type="number" min="0" max="100" />
              <input id="tplCurrency" placeholder="Currency symbol" maxlength="3" />
              <input id="tplNote" placeholder="Footer note" />
              <label class="file-upload">
                <input id="tplLogo" type="file" accept="image/*" class="hidden">
                <i class="fas fa-image"></i>
                <span data-i18n="upload_logo">Upload logo</span>
              </label>
              <button id="saveTplBtn" class="btn-secondary" data-i18n="save_template">Save template</button>
            </div>
            <div class="invoice-actions">
              <button id="downloadPdfBtn" class="btn-primary">
                <i class="fas fa-file-pdf"></i>
                Download PDF
              </button>
              <button id="viewReportBtn" class="btn-secondary">
                <i class="fas fa-chart-bar"></i>
                View Sales Report
              </button>
            </div>
            <div id="tplPreview" class="invoice-preview"></div>
          </div>
        </div>
      </section>

      <!-- ADS -->
      <section id="page-ads" class="page">
        <div class="page-header">
          <h2 data-i18n="advertising">Advertising</h2>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3 data-i18n="ad_campaigns">Ad campaigns</h3>
            <div class="form-grid">
              <input id="adName" placeholder="Campaign name" />
              <input id="adSpend" type="number" min="0" placeholder="Invested amount" />
              <input id="adStart" type="date" />
              <button id="addAdBtn" class="btn-primary">
                <i class="fas fa-plus"></i>
                <span data-i18n="add">Add</span>
              </button>
            </div>
            <div id="adsList" class="items-list"></div>
          </div>
          <div class="card">
            <h3 data-i18n="ad_effect">Effect: before vs after</h3>
            <canvas id="adChart" height="140"></canvas>
            <p class="hint" data-i18n="ad_hint">Compares 30 days before vs 30 days after the campaign start date.</p>
          </div>
        </div>
      </section>

      <!-- RECOMMENDATIONS -->
      <section id="page-recommend" class="page">
        <div class="page-header">
          <h2 data-i18n="recommendations">Recommendations</h2>
        </div>
        <div class="card">
          <h3 data-i18n="recommendations">Recommendations (daily)</h3>
          <ul id="recList" class="recs-list"></ul>
        </div>
      </section>

      <!-- EMPLOYEES -->
      <section id="page-employees" class="page">
        <div class="page-header">
          <h2 data-i18n="employees">Employees</h2>
        </div>

        <div class="grid-two">
          <div class="card">
            <h3 data-i18n="team">Team</h3>
            <div class="form-grid">
              <input id="empName" placeholder="Full name" />
              <input id="empEmail" type="email" placeholder="Email" />
              <input id="empSalary" type="number" min="0" placeholder="Monthly salary" />
              <button id="addEmpBtn" class="btn-primary">
                <i class="fas fa-plus"></i>
                <span data-i18n="add">Add</span>
              </button>
            </div>
            <div id="empList" class="items-list"></div>
          </div>
          <div class="card">
            <h3 data-i18n="permissions">Permissions</h3>
            <div id="permMatrix" class="table-responsive"></div>
            <div class="divider"></div>
            <h4 data-i18n="time_tracking">Time tracking</h4>
            <div class="form-grid">
              <input id="ttEmpEmail" type="email" placeholder="employee@email.com" />
              <input id="ttHours" type="number" min="0" step="0.25" placeholder="Hours" />
              <input id="ttDate" type="date" />
              <button id="logTimeBtn" class="btn-secondary" data-i18n="log_time">Log time</button>
            </div>
            <div id="timeList" class="items-list"></div>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="page-settings" class="page">
        <div class="page-header">
          <h2 data-i18n="settings">Settings</h2>
        </div>

        <div class="card">
          <h3 data-i18n="app_settings">App settings</h3>
          <div class="settings-grid">
            <div class="form-group">
              <label data-i18n="language">Language</label>
              <select id="settingsLang">
                <option value="en">English</option>
                <option value="bn">বাংলা</option>
              </select>
            </div>

            <div class="form-group">
              <label data-i18n="currency_symbol">Currency symbol</label>
              <input id="settingsCurrency" maxlength="3" placeholder="৳" />
            </div>

            <div class="form-group">
              <label data-i18n="default_low_stock">Default low stock threshold</label>
              <input id="settingsLowStock" type="number" min="0" value="5" />
            </div>

            <div class="form-group">
              <label data-i18n="invite_employee">Invite employee</label>
              <div class="input-group">
                <input id="inviteEmail" type="email" placeholder="email@domain.com" />
                <button id="createInviteBtn" class="btn-secondary" data-i18n="create_invite">Create invite</button>
              </div>
              <pre id="invitePreview" class="preview"></pre>
            </div>
          </div>

          <div class="danger-zone">
            <button id="resetAppBtn" class="btn-danger">
              <i class="fas fa-trash-alt"></i>
              <span data-i18n="reset_app">Reset app (clear data)</span>
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- Product Modal -->
    <div id="productModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="productModalTitle">Add Product</h3>
          <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Product Name</label>
            <input id="modalProductName" placeholder="Enter product name" />
          </div>
          <div class="form-group">
            <label>SKU</label>
            <input id="modalProductSku" placeholder="e.g., SKU1234" />
          </div>
          <div class="form-group">
            <label>Initial Stock</label>
            <input id="modalProductStock" type="number" min="0" placeholder="0" />
          </div>
          <div class="form-group">
            <label>Buying Price</label>
            <input id="modalProductBuy" type="number" min="0" step="0.01" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label>Selling Price</label>
            <input id="modalProductSell" type="number" min="0" step="0.01" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label>Low Stock Threshold (optional)</label>
            <input id="modalProductLow" type="number" min="0" placeholder="5" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-ghost modal-cancel">Cancel</button>
          <button id="modalProductSave" class="btn-primary">Save Product</button>
        </div>
      </div>
    </div>

    <!-- Sales Report Modal -->
    <div id="salesReportModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h3>Sales Report</h3>
          <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
          <div id="salesReportContent"></div>
        </div>
        <div class="modal-footer">
          <button class="btn-ghost modal-cancel">Close</button>
          <button id="exportReportBtn" class="btn-primary">
            <i class="fas fa-download"></i>
            Export Report
          </button>
        </div>
      </div>
    </div>

    <!-- BizBot -->
    <button id="botFab" class="fab">
      <img src="assets/chat.png" alt="Chatbot" class="bot-icon">
    </button>
    <div id="botPanel" class="bot hidden">
      <div class="bot-header">
        <strong><img src="assets/chat.png" alt="BizBot" class="bot-header-icon"> BizBot</strong>
        <button id="botClose" class="icon-btn"><i class="fas fa-times"></i></button>
      </div>
      <div id="botLog" class="bot-log"></div>
      <div class="bot-suggestions" id="botSuggestions"></div>
      <div class="bot-input">
        <input id="botMsg" placeholder="Ask BizBot..." />
        <button id="botSend" class="btn-primary">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
  <!-- Camera Modal -->
  <div id="cameraModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Scan Product with Camera</h3>
        <button class="modal-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="camera-container">
          <video id="cameraVideo" autoplay playsinline></video>
          <canvas id="cameraCanvas"></canvas>
          <div class="camera-preview hidden" id="cameraPreview">
            <img id="previewImage" src="" alt="Captured image">
            <p>Image captured! Fill in product details below.</p>
          </div>
        </div>

        <div class="camera-controls">
          <button id="startCamera" class="btn-primary">
            <i class="fas fa-camera"></i>
            Start Camera
          </button>
          <button id="captureBtn" class="btn-secondary hidden">
            <i class="fas fa-camera-retro"></i>
            Capture
          </button>
          <button id="retakeBtn" class="btn-ghost hidden">
            <i class="fas fa-redo"></i>
            Retake
          </button>
        </div>

        <!-- Product form appears after capture -->
        <div id="productForm" class="hidden" style="margin-top: 20px;">
          <div class="form-group">
            <label>Product Name</label>
            <input id="scannedProductName" placeholder="Enter product name from scan">
          </div>
          <div class="form-group">
            <label>SKU</label>
            <input id="scannedProductSku" placeholder="SKU will be auto-generated">
          </div>
          <div class="form-group">
            <label>Initial Stock</label>
            <input id="scannedProductStock" type="number" min="0" value="1">
          </div>
          <div class="form-group">
            <label>Buying Price</label>
            <input id="scannedProductBuy" type="number" min="0" step="0.01" placeholder="0.00">
          </div>
          <div class="form-group">
            <label>Selling Price</label>
            <input id="scannedProductSell" type="number" min="0" step="0.01" placeholder="0.00">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-ghost modal-cancel">Cancel</button>
        <button id="saveScannedProduct" class="btn-primary hidden">
          <i class="fas fa-save"></i>
          Save Product
        </button>
      </div>
    </div>
  </div>
</body>
</html>